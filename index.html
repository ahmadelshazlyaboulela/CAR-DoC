import React, { useState, useEffect, useRef } from 'react';
import { 
  Wrench, 
  Search, 
  MapPin, 
  Car, 
  Phone, 
  AlertTriangle, 
  DollarSign, 
  History,
  Camera,
  Cpu,
  ShieldCheck,
  ChevronRight,
  Settings,
  X,
  Zap,
  MessageSquare,
  ArrowLeft,
  Mic,
  Video,
  Upload,
  Play,
  Droplets,
  Calendar,
  Volume2,
  Info
} from 'lucide-react';

const apiKey = ""; // Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ© ØªÙˆÙØ± Ø§Ù„Ù…ÙØªØ§Ø­ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹

// --- Logo Component: CAR_Doc with 3D Maybach Rim "o" ---
const Logo = () => {
  return (
    // Wrapped in dir="ltr" to ensure CAR_Doc order is correct regardless of page RTL
    <div className="relative flex items-center gap-0 group cursor-default" dir="ltr">
      {/* Animated Smoke/Steam Effect */}
      <div className="absolute -left-10 top-0 w-full h-full pointer-events-none opacity-40">
        <div className="smoke-particle p1"></div>
        <div className="smoke-particle p2"></div>
        <div className="smoke-particle p3"></div>
      </div>

      <div className="relative z-10 flex items-center text-4xl font-black italic tracking-tighter select-none">
        {/* CAR_D Part */}
        <span className="text-white drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]">CAR_D</span>
        
        {/* The 3D Mercedes-Maybach Rim "o" */}
        <div className="relative w-11 h-11 mx-0.5 flex items-center justify-center">
          <div className="absolute inset-0 bg-amber-500/10 rounded-full blur-lg animate-pulse"></div>
          
          <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-2xl overflow-visible animate-maybach-spin">
            <defs>
              <linearGradient id="rimGold" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style={{stopColor:'#FFD700', stopOpacity:1}} />
                <stop offset="50%" style={{stopColor:'#B8860B', stopOpacity:1}} />
                <stop offset="100%" style={{stopColor:'#8B6508', stopOpacity:1}} />
              </linearGradient>
              <linearGradient id="rimBlack" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style={{stopColor:'#333', stopOpacity:1}} />
                <stop offset="100%" style={{stopColor:'#000', stopOpacity:1}} />
              </linearGradient>
            </defs>
            <circle cx="50" cy="50" r="46" fill="#0a0a0a" stroke="#1a1a1a" strokeWidth="4" />
            <circle cx="50" cy="50" r="38" fill="url(#rimBlack)" stroke="url(#rimGold)" strokeWidth="1.5" />
            {[...Array(12)].map((_, i) => (
              <line 
                key={i}
                x1="50" y1="50" 
                x2={50 + 34 * Math.cos((i * 30 * Math.PI) / 180)} 
                y2={50 + 34 * Math.sin((i * 30 * Math.PI) / 180)} 
                stroke="url(#rimGold)" 
                strokeWidth="1.5" 
              />
            ))}
            <circle cx="50" cy="50" r="12" fill="url(#rimBlack)" stroke="url(#rimGold)" strokeWidth="1" />
            {/* Mercedes Star Icon in Maybach Rim */}
            <path d="M50 42 L52 49 L59 49 L53 53 L55 60 L50 56 L45 60 L47 53 L41 49 L48 49 Z" fill="url(#rimGold)" />
          </svg>
        </div>

        {/* c Part */}
        <span className="text-white drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]">c</span>
      </div>

      <style>{`
        @keyframes maybach-spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
        .animate-maybach-spin { animation: maybach-spin 8s linear infinite; }
        .smoke-particle { position: absolute; background: rgba(255, 255, 255, 0.08); border-radius: 50%; filter: blur(18px); opacity: 0; }
        @keyframes smoke-float { 0% { transform: translate(0, 0) scale(0.5); opacity: 0; } 50% { opacity: 0.15; } 100% { transform: translate(-60px, -30px) scale(2.5); opacity: 0; } }
        .p1 { width: 60px; height: 60px; animation: smoke-float 4s infinite; }
        .p2 { width: 40px; height: 40px; animation: smoke-float 5s infinite 1.5s; }
        .p3 { width: 80px; height: 80px; animation: smoke-float 6s infinite 0.5s; }
      `}</style>
    </div>
  );
};

// --- Custom Jeep Cherokee 2026 Loading Animation ---
const CherokeeLoading = () => {
  return (
    <div className="flex flex-col items-center gap-8 w-full max-w-lg">
      <div className="relative w-full h-48 overflow-hidden rounded-[40px] bg-[#0a0f18] border border-white/5 flex items-end justify-center">
        
        {/* Moving City Background */}
        <div className="absolute inset-0 opacity-20 pointer-events-none">
          <div className="city-animation flex">
            <svg className="h-full w-auto min-w-full" viewBox="0 0 1000 200" preserveAspectRatio="none">
              <path d="M0,200 L0,150 L30,150 L30,100 L70,100 L70,130 L100,130 L100,80 L150,80 L150,140 L200,140 L200,60 L260,60 L260,160 L310,160 L310,100 L360,100 L360,140 L410,140 L410,80 L480,80 L480,150 L540,150 L540,90 L600,90 L600,140 L660,140 L660,70 L730,70 L730,160 L800,160 L800,100 L870,100 L870,140 L930,140 L930,80 L1000,80 L1000,200 Z" fill="#334155" />
            </svg>
            <svg className="h-full w-auto min-w-full" viewBox="0 0 1000 200" preserveAspectRatio="none">
              <path d="M0,200 L0,150 L30,150 L30,100 L70,100 L70,130 L100,130 L100,80 L150,80 L150,140 L200,140 L200,60 L260,60 L260,160 L310,160 L310,100 L360,100 L360,140 L410,140 L410,80 L480,80 L480,150 L540,150 L540,90 L600,90 L600,140 L660,140 L660,70 L730,70 L730,160 L800,160 L800,100 L870,100 L870,140 L930,140 L930,80 L1000,80 L1000,200 Z" fill="#334155" />
            </svg>
          </div>
        </div>

        {/* Moving Road */}
        <div className="absolute bottom-0 w-full h-8 bg-slate-900 flex items-center">
          <div className="road-lines flex w-[200%]">
             {[...Array(20)].map((_, i) => (
               <div key={i} className="h-1 w-12 bg-slate-700/50 mx-8 rounded-full"></div>
             ))}
          </div>
        </div>

        {/* The White Jeep Cherokee SUV */}
        <div className="relative mb-6 jeep-bounce z-10">
          <svg width="180" height="80" viewBox="0 0 200 80" className="drop-shadow-[0_10px_15px_rgba(0,0,0,0.5)]">
            {/* Body */}
            <path d="M20,60 L180,60 L180,45 L170,30 L120,25 L50,25 L35,30 L20,45 Z" fill="#ffffff" />
            <path d="M50,25 L120,25 L115,35 L55,35 Z" fill="#1e293b" /> {/* Windows */}
            <rect x="25" y="45" width="20" height="8" rx="2" fill="#e2e8f0" opacity="0.6" /> {/* Headlight */}
            <rect x="170" y="45" width="10" height="8" rx="2" fill="#ef4444" /> {/* Brake light */}
            
            {/* Cherokee Grill / Details */}
            <rect x="20" y="52" width="10" height="8" fill="#cbd5e1" opacity="0.8" />
            
            {/* Wheels */}
            <g className="wheel-spin">
              <circle cx="50" cy="65" r="10" fill="#111" stroke="#333" strokeWidth="2" />
              <path d="M50 55 L50 75 M40 65 L60 65" stroke="#444" strokeWidth="1" />
            </g>
            <g className="wheel-spin">
              <circle cx="150" cy="65" r="10" fill="#111" stroke="#333" strokeWidth="2" />
              <path d="M150 55 L150 75 M140 65 L160 65" stroke="#444" strokeWidth="1" />
            </g>
          </svg>
        </div>
      </div>

      <style>{`
        @keyframes city-move {
          0% { transform: translateX(0); }
          100% { transform: translateX(-100%); }
        }
        .city-animation {
          animation: city-move 20s linear infinite;
        }
        @keyframes road-move {
          0% { transform: translateX(0); }
          100% { transform: translateX(-50%); }
        }
        .road-lines {
          animation: road-move 0.8s linear infinite;
        }
        @keyframes jeep-vibrate {
          0%, 100% { transform: translateY(0) rotate(0deg); }
          25% { transform: translateY(-1px) rotate(0.2deg); }
          75% { transform: translateY(1px) rotate(-0.2deg); }
        }
        .jeep-bounce {
          animation: jeep-vibrate 0.15s infinite;
        }
        @keyframes wheel-rotate {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
        .wheel-spin g {
          transform-origin: center;
          animation: wheel-rotate 0.4s linear infinite;
        }
      `}</style>
    </div>
  );
};

export default function App() {
  const [inputMode, setInputMode] = useState('text');
  const [symptom, setSymptom] = useState('');
  const [selectedMedia, setSelectedMedia] = useState(null);
  const [isRecording, setIsRecording] = useState(false);
  const [diagnosisResult, setDiagnosisResult] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  const [maintenancePlan, setMaintenancePlan] = useState(null);
  const [carModel, setCarModel] = useState('');
  const [mileage, setMileage] = useState('');

  const callGemini = async (prompt, systemInstruction) => {
    const maxRetries = 5;
    let delay = 1000;
    for (let i = 0; i < maxRetries; i++) {
      try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{ parts: [{ text: prompt }] }],
            systemInstruction: { parts: [{ text: systemInstruction }] },
            generationConfig: { responseMimeType: "application/json" }
          })
        });
        if (!response.ok) throw new Error('API Error');
        const data = await response.json();
        return JSON.parse(data.candidates[0].content.parts[0].text);
      } catch (err) {
        if (i === maxRetries - 1) throw err;
        await new Promise(r => setTimeout(r, delay));
        delay *= 2;
      }
    }
  };

  const handleStartAnalysis = async () => {
    if (!symptom.trim() && !selectedMedia) return;
    setLoading(true);
    setError(null);
    try {
      const systemPrompt = `Ø§Ù†Øª Ø®Ø¨ÙŠØ± Ù…ÙŠÙƒØ§Ù†ÙŠÙƒØ§ Ø³ÙŠØ§Ø±Ø§Øª Ù…Ø­ØªØ±Ù Ø§Ø³Ù…Ùƒ CAR_Doc. Ø­Ù„Ù„ Ø§Ù„Ø¹Ø·Ù„ Ø¨Ø§Ù„Ø¹Ø§Ù…ÙŠØ© Ø§Ù„Ù…ØµØ±ÙŠØ© Ø¨Ø£Ø³Ù„ÙˆØ¨ ÙØ®Ù…. Ø±Ø¯ Ø¨Ù€ JSON ÙÙ‚Ø·: { "title": "...", "analysis": "...", "severity": "high/medium/low", "estimated_price": "...", "parts_needed": ["..."], "diy_guide": "...", "emergency_tip": "..." }`;
      const result = await callGemini(symptom || "Ø­Ù„Ù„ Ø§Ù„Ø¹Ø·Ù„ Ø§Ù„Ù…Ø±ÙÙ‚", systemPrompt);
      setDiagnosisResult(result);
    } catch (err) { setError("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ø­Ø±Ùƒ. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰."); } finally { setLoading(false); }
  };

  const handleGenerateMaintenance = async () => {
    if (!carModel || !mileage) return;
    setLoading(true);
    try {
      const systemPrompt = `Ø§Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ ØµÙŠØ§Ù†Ø© Ø³ÙŠØ§Ø±Ø§Øª. Ù‚Ø¯Ù… Ø®Ø·Ø© ØµÙŠØ§Ù†Ø© Ø¨Ø§Ù„Ø¹Ø§Ù…ÙŠØ© Ø§Ù„Ù…ØµØ±ÙŠØ©. Ø±Ø¯ Ø¨Ù€ JSON: { "plan_title": "...", "urgent_items": ["..."], "upcoming_items": ["..."], "estimated_cost": "..." }`;
      const result = await callGemini(`Ø³ÙŠØ§Ø±Ø© ${carModel} Ù…Ø§Ø´ÙŠØ© ${mileage} ÙƒÙ….`, systemPrompt);
      setMaintenancePlan(result);
    } catch (err) { setError("ÙØ´Ù„ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø®Ø·Ø©."); } finally { setLoading(false); }
  };

  const handleSpeakDiagnosis = async () => {
    if (!diagnosisResult) return;
    try {
      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{ parts: [{ text: `Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ù‡ÙŠ ${diagnosisResult.title}. ÙˆØ§Ù„Ø³Ø¨Ø¨ Ù‡Ùˆ ${diagnosisResult.analysis}.` }] }],
          generationConfig: { 
            responseModalities: ["AUDIO"],
            speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Kore" } } }
          }
        })
      });
      const data = await response.json();
      const audioUrl = `data:audio/l16;base64,${data.candidates[0].content.parts[0].inlineData.data}`;
      new Audio(audioUrl).play().catch(() => {});
    } catch (err) { console.error(err); }
  };

  const handleFileUpload = (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onloadend = () => setSelectedMedia(reader.result);
      reader.readAsDataURL(file);
    }
  };

  return (
    <div className="min-h-screen bg-[#05070a] text-slate-200 font-sans selection:bg-cyan-500/30 overflow-x-hidden" dir="rtl">
      
      <div className="fixed inset-0 pointer-events-none">
        <div className="absolute top-0 left-1/2 -translate-x-1/2 w-full h-full bg-[radial-gradient(circle_at_50%_0%,rgba(6,182,212,0.12)_0%,rgba(0,0,0,0)_60%)]" />
      </div>

      <nav className="sticky top-0 z-[100] border-b border-white/5 bg-[#05070a]/90 backdrop-blur-md px-8 h-24 flex items-center justify-between">
        <Logo />
        <div className="flex gap-3">
          <button className="p-3 bg-white/5 rounded-2xl border border-white/5 hover:bg-white/10 transition-all"><History className="w-5 h-5 text-slate-400" /></button>
          <button className="p-3 bg-white/5 rounded-2xl border border-white/5 hover:bg-white/10 transition-all"><Settings className="w-5 h-5 text-slate-400" /></button>
        </div>
      </nav>

      <main className="max-w-4xl mx-auto px-6 pt-12 pb-32">
        
        {!diagnosisResult && !maintenancePlan && !loading && (
          <div className="text-center mb-12 animate-in fade-in duration-1000">
            <h2 className="text-5xl md:text-7xl font-black text-white mb-6 leading-tight tracking-tight">
              ØµÙŠØ§Ù†Ø© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ <br/> 
              <span className="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500 italic">Ø¨ÙŠÙ† ÙŠØ¯ÙŠÙƒ Ø§Ù„Ø¢Ù†</span>
            </h2>
            <p className="text-slate-500 text-sm opacity-60">CAR_Doc: Ø§Ù„Ø­Ù„ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ù„ÙƒÙ„ Ø£Ø¹Ø·Ø§Ù„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</p>
          </div>
        )}

        {!diagnosisResult && !maintenancePlan && !loading && (
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
            <div className="p-8 bg-white/5 rounded-[40px] border border-white/10 hover:border-cyan-500/30 transition-all group cursor-pointer" onClick={() => setInputMode('text')}>
               <Cpu className="w-10 h-10 text-cyan-400 mb-4 group-hover:scale-110 transition-transform" />
               <h3 className="text-2xl font-black mb-2">ØªØ´Ø®ÙŠØµ Ø§Ù„Ø£Ø¹Ø·Ø§Ù„</h3>
               <button className="text-cyan-400 font-bold flex items-center gap-2">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù† <ChevronRight className="w-4 h-4" /></button>
            </div>
            <div className="p-8 bg-white/5 rounded-[40px] border border-white/10 hover:border-blue-500/30 transition-all group cursor-pointer" onClick={() => setInputMode('maintenance')}>
               <Calendar className="w-10 h-10 text-blue-400 mb-4 group-hover:scale-110 transition-transform" />
               <h3 className="text-2xl font-black mb-2">Ø®Ø·Ø© ØµÙŠØ§Ù†Ø© ÙˆÙ‚Ø§Ø¦ÙŠØ©</h3>
               <button className="text-blue-400 font-bold flex items-center gap-2">ØµÙ…Ù… Ø®Ø·ØªÙƒ <ChevronRight className="w-4 h-4" /></button>
            </div>
          </div>
        )}

        {inputMode !== 'maintenance' && !diagnosisResult && (
          <div className={`transition-all duration-700 ${loading ? 'opacity-50 blur-sm pointer-events-none' : 'scale-100'}`}>
            <div className="bg-[#0e121a] rounded-[50px] border border-white/10 shadow-2xl overflow-hidden relative">
              <div className="flex border-b border-white/5 bg-black/40 p-3 gap-3">
                {[
                  { id: 'text', icon: MessageSquare, label: 'ÙˆØµÙ Ù†ØµÙŠ' },
                  { id: 'image', icon: Camera, label: 'ØµÙˆØ±' },
                  { id: 'audio', icon: Mic, label: 'Ø¨ØµÙ…Ø© Ø§Ù„ØµÙˆØª' }
                ].map(mode => (
                  <button key={mode.id} onClick={() => { setInputMode(mode.id); setSelectedMedia(null); }} className={`flex-1 py-4 rounded-3xl flex items-center justify-center gap-3 transition-all font-black text-xs ${inputMode === mode.id ? 'bg-gradient-to-tr from-cyan-500 to-blue-600 text-white shadow-xl shadow-cyan-500/20' : 'text-slate-600 hover:text-slate-300 hover:bg-white/5'}`}>
                    <mode.icon className="w-4 h-4" /> <span className="hidden md:inline">{mode.label}</span>
                  </button>
                ))}
              </div>

              <div className="p-10 md:p-16">
                {inputMode === 'text' && (
                  <textarea className="w-full bg-transparent border-none text-2xl text-white placeholder:text-slate-800 outline-none resize-none h-40 font-medium" placeholder="Ø§ÙˆØµÙ Ø§Ù„Ù„ÙŠ Ø­Ø§Ø³Ø³ Ø¨ÙŠÙ‡ ÙÙŠ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©.." value={symptom} onChange={(e) => setSymptom(e.target.value)} />
                )}
                {inputMode === 'image' && (
                  <div className="flex flex-col items-center justify-center py-12 border-2 border-dashed border-white/10 rounded-[40px] bg-black/40 group hover:border-cyan-500/30 transition-all">
                    {selectedMedia ? (
                      <div className="relative group/media">
                        <img src={selectedMedia} alt="Preview" className="w-72 h-72 object-cover rounded-[35px] border-4 border-white/5" />
                        <button onClick={() => setSelectedMedia(null)} className="absolute -top-4 -right-4 bg-red-500 p-3 rounded-full shadow-2xl"><X className="w-5 h-5 text-white" /></button>
                      </div>
                    ) : (
                      <label className="cursor-pointer flex flex-col items-center p-12">
                        <Camera className="w-14 h-14 text-cyan-400 mb-6" /> <p className="text-white text-2xl font-black">ØµÙˆØ± Ø§Ù„Ø¹Ø·Ù„</p>
                        <input type="file" className="hidden" accept="image/*" onChange={handleFileUpload} />
                      </label>
                    )}
                  </div>
                )}
                <button onClick={handleStartAnalysis} disabled={loading || (!symptom.trim() && !selectedMedia)} className="w-full mt-12 bg-gradient-to-r from-cyan-500 to-blue-600 text-white py-6 rounded-[30px] font-black text-2xl shadow-2xl hover:-translate-y-2 transition-all disabled:opacity-20 flex justify-center items-center gap-5">
                   <span>Ø§Ø¨Ø¯Ø£ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø°ÙƒÙŠ</span>
                   <Zap className="w-7 h-7" />
                </button>
              </div>
            </div>
          </div>
        )}

        {inputMode === 'maintenance' && !maintenancePlan && (
          <div className="bg-[#0e121a] rounded-[50px] border border-white/10 p-12 md:p-16 shadow-2xl">
             <div className="flex items-center gap-3 mb-8"> <Calendar className="text-blue-400 w-8 h-8" /> <h3 className="text-3xl font-black">ØµÙ…Ù… Ø®Ø·Ø© ØµÙŠØ§Ù†ØªÙƒ</h3> </div>
             <div className="space-y-6">
                <div> <label className="block text-slate-500 text-sm font-bold mb-2">Ù…ÙˆØ¯ÙŠÙ„ ÙˆØ³Ù†Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©</label> <input type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ù‡ÙŠÙˆÙ†Ø¯Ø§ÙŠ Ø¥Ù„Ù†ØªØ±Ø§ 2020" className="w-full bg-white/5 border border-white/10 rounded-2xl p-4 text-xl outline-none" value={carModel} onChange={(e) => setCarModel(e.target.value)} /> </div>
                <div> <label className="block text-slate-500 text-sm font-bold mb-2">Ø§Ù„Ù…Ù…Ø´Ù‰ Ø§Ù„Ø­Ø§Ù„ÙŠ (ÙƒÙ…)</label> <input type="number" placeholder="Ù…Ø«Ù„Ø§Ù‹: 85000" className="w-full bg-white/5 border border-white/10 rounded-2xl p-4 text-xl outline-none" value={mileage} onChange={(e) => setMileage(e.target.value)} /> </div>
                <button onClick={handleGenerateMaintenance} disabled={loading || !carModel || !mileage} className="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-6 rounded-3xl font-black text-xl shadow-xl hover:-translate-y-1 transition-all">
                  <span>ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø®Ø·Ø©</span>
                </button>
                <button onClick={() => { setInputMode('text'); setDiagnosisResult(null); }} className="w-full text-slate-600 font-bold">Ø¥Ù„ØºØ§Ø¡</button>
             </div>
          </div>
        )}

        {maintenancePlan && (
          <div className="mt-16 space-y-10 animate-in fade-in slide-in-from-bottom-20 duration-1000">
            <button onClick={() => setMaintenancePlan(null)} className="flex items-center gap-3 text-slate-500 hover:text-white transition-all font-bold"> <ArrowLeft className="w-5 h-5" /> <span>Ø§Ù„Ø¹ÙˆØ¯Ø©</span> </button>
            <div className="bg-[#111827] rounded-[55px] border border-blue-500/20 p-12 shadow-2xl">
               <h2 className="text-4xl font-black text-white mb-4">{maintenancePlan.plan_title}</h2>
               <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mt-10">
                  <div className="bg-red-500/5 border border-red-500/10 p-8 rounded-[40px]"> <h4 className="text-red-400 font-black mb-4 flex items-center gap-2">âš ï¸ ØµÙŠØ§Ù†Ø© Ø¹Ø§Ø¬Ù„Ø©</h4> <ul className="space-y-3"> {maintenancePlan.urgent_items.map((item, i) => ( <li key={i} className="text-slate-300 flex items-start gap-2">â€¢ {item}</li> ))} </ul> </div>
                  <div className="bg-cyan-500/5 border border-cyan-500/10 p-8 rounded-[40px]"> <h4 className="text-cyan-400 font-black mb-4 flex items-center gap-2">ğŸ“… ØµÙŠØ§Ù†Ø© Ø¯ÙˆØ±ÙŠØ©</h4> <ul className="space-y-3"> {maintenancePlan.upcoming_items.map((item, i) => ( <li key={i} className="text-slate-300 flex items-start gap-2">â€¢ {item}</li> ))} </ul> </div>
               </div>
               <div className="mt-8 p-6 bg-white/5 rounded-3xl text-center"> <span className="text-slate-500 block text-xs font-bold mb-1 italic">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ©</span> <span className="text-3xl font-black text-white">{maintenancePlan.estimated_cost}</span> </div>
            </div>
          </div>
        )}

        {diagnosisResult && (
          <div className="mt-16 space-y-10 animate-in fade-in slide-in-from-bottom-20 duration-1000">
            <div className="flex items-center justify-between px-6">
              <button onClick={() => { setDiagnosisResult(null); setSymptom(''); }} className="flex items-center gap-3 text-slate-500 hover:text-white transition-all font-bold"> <ArrowLeft className="w-6 h-6" /> <span>ØªØ´Ø®ÙŠØµ Ø¬Ø¯ÙŠØ¯</span> </button>
              <button onClick={handleSpeakDiagnosis} className="flex items-center gap-3 bg-cyan-500/10 px-6 py-3 rounded-full border border-cyan-500/20 text-cyan-400 font-bold transition-all hover:bg-cyan-500/20"> <Volume2 className="w-5 h-5" /> Ø§Ø³Ù…Ø¹ Ø§Ù„ØªØ´Ø®ÙŠØµ </button>
            </div>
            <div className={`p-1 rounded-[55px] bg-gradient-to-br ${diagnosisResult.severity === 'high' ? 'from-red-500/60 to-orange-500/60 shadow-red-500/15' : 'from-cyan-500/60 to-blue-600/60 shadow-cyan-500/15'}`}>
              <div className="bg-[#0e121a] rounded-[54px] p-12 md:p-16 relative overflow-hidden">
                <div className="flex flex-col md:flex-row gap-12 items-start relative z-10">
                  <div className={`p-10 rounded-[45px] ${diagnosisResult.severity === 'high' ? 'bg-red-500/10 text-red-500' : 'bg-cyan-500/10 text-cyan-400'}`}> <AlertTriangle className="w-20 h-20" /> </div>
                  <div className="flex-1">
                    <h2 className="text-5xl font-black text-white mb-8 leading-tight">{diagnosisResult.title}</h2>
                    <p className="text-slate-400 text-2xl font-medium leading-relaxed mb-12">{diagnosisResult.analysis}</p>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                      <div className="bg-white/5 p-10 rounded-[40px] border border-white/5"> <div className="text-slate-500 font-black text-xs uppercase mb-4"> <DollarSign className="w-5 h-5 text-cyan-500 inline" /> Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø¥ØµÙ„Ø§Ø­ </div> <div className="text-4xl font-black text-white">{diagnosisResult.estimated_price}</div> </div>
                      <div className="bg-white/5 p-10 rounded-[40px] border border-white/5"> <div className="text-slate-500 font-black text-xs uppercase mb-4"> <ShieldCheck className="w-5 h-5 text-red-500 inline" /> ØªØ¹Ù„ÙŠÙ…Ø§Øª ÙÙˆØ±ÙŠØ© </div> <div className="text-xl font-black text-red-400 italic">"{diagnosisResult.emergency_tip}"</div> </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-10 px-4">
               <div className="lg:col-span-2 bg-[#111827] p-12 rounded-[55px] border border-white/10">
                  <h4 className="font-black text-3xl text-white mb-10 flex items-center gap-4"><Wrench className="w-8 h-8 text-cyan-500" /> Ø§Ù„Ù‚Ø·Ø¹ ÙˆØ§Ù„Ø­Ù„ </h4>
                  <div className="flex flex-wrap gap-4 mb-10"> {diagnosisResult.parts_needed.map((p, i) => ( <div key={i} className="px-8 py-4 bg-black/40 border border-white/10 rounded-2xl text-lg font-bold text-slate-200">{p}</div> ))} </div>
                  <div className="p-10 bg-cyan-500/5 rounded-[35px] border border-cyan-500/20"> <p className="text-cyan-400 font-black mb-4 text-xl">ØªØ£ÙƒØ¯ Ø¨Ù†ÙØ³Ùƒ:</p> <p className="text-slate-300 text-xl leading-relaxed italic">{diagnosisResult.diy_guide}</p> </div>
               </div>
               <div className="bg-gradient-to-br from-blue-700 to-indigo-900 p-12 rounded-[55px] flex flex-col justify-between group overflow-hidden relative">
                  <div className="relative z-10 text-white"> <h4 className="font-black text-4xl mb-6 italic">Ø§Ù„ÙˆØ±Ø´ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©</h4> <p className="text-blue-100/80 text-xl mb-12 font-medium">Ø¨Ø­Ø«Ù†Ø§ Ù„Ùƒ Ø¹Ù† Ø£ÙØ¶Ù„ ÙÙ†ÙŠÙŠÙ† Ù„Ø¶Ù…Ø§Ù† Ø¬ÙˆØ¯Ø© Ø§Ù„ØªØµÙ„ÙŠØ­.</p> </div>
                  <button className="relative z-10 w-full bg-white text-blue-900 py-7 rounded-[30px] font-black text-xl hover:scale-105 transition-all flex items-center justify-center gap-4"> <MapPin className="w-8 h-8" /> Ø®Ø±ÙŠØ·Ø© Ø§Ù„ÙˆØ±Ø´ </button>
               </div>
            </div>
          </div>
        )}
      </main>

      {/* Modern SUV Cinematic Loading Overlay */}
      {loading && (
        <div className="fixed inset-0 z-[200] bg-[#05070a]/90 backdrop-blur-xl flex items-center justify-center p-6">
          <div className="flex flex-col items-center gap-12 w-full max-w-2xl">
            <CherokeeLoading />
            <div className="flex flex-col items-center gap-2">
              <p className="text-3xl font-black text-white tracking-tight animate-pulse">CAR_Doc ÙŠØ­Ù„Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¢Ù†...</p>
              <div className="flex items-center gap-2 text-cyan-500 font-bold uppercase text-xs tracking-[0.3em]">
                <Cpu className="w-4 h-4" />
                <span>AI Processing engine</span>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
